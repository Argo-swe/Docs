\subsection{Back-end}

%SEZIONE ROUTES DI dictionaries_api

\subsubsection{get\_all\_dictionaries}

\subsubsubsection{Descrizione}
\par La funzione \texttt{get\_all\_dictionaries} recupera tutti i dizionari presenti nel sistema e restituisce una risposta strutturata.

\subsubsubsection{Dettagli dell'endpoint}
\begin{itemize}
  \item \textbf{HTTP Method}: \texttt{GET};
  \item \textbf{Endpoint}: \texttt{/};
  \item \textbf{Tags}: \texttt{[tag]};
  \item \textbf{Response Model}: \texttt{DictionariesResponseDto};
  \item \textbf{Nome}: \texttt{getAllDictionaries};
  \item \textbf{Dependency Injection}:
  \begin{itemize}
    \item \textbf{dictionary\_service (DictionaryService)}: dipendenza risolta tramite Depends (get\_dictionary\_service).
  \end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
  \item Effettua una chiamata al servizio di gestione dei dizionari per recuperare l'elenco completo dei dizionari;
  \item Restituisce un oggetto \texttt{DictionariesResponseDto} con lo stato della risposta e, in caso di successo, i dati richiesti.
\end{itemize}

\subsubsection{get\_dictionary}

\subsubsubsection{Descrizione}
\par La funzione \texttt{get\_dictionary} recupera un dizionario specifico utilizzando l'ID fornito e restituisce una risposta strutturata.

\subsubsubsection{Dettagli dell'endpoint}
\begin{itemize}
  \item \textbf{HTTP Method}: \texttt{GET};
  \item \textbf{Endpoint}: \texttt{/\{id\}/file};
  \item \textbf{Tags}: \texttt{[tag]};
  \item \textbf{Response Model}: \texttt{DictionaryResponseDto};
  \item \textbf{Nome}: \texttt{getDictionary};
  \item \textbf{Dependency Injection}:
  \begin{itemize}
    \item \textbf{dictionary\_service (DictionaryService)}: dipendenza risolta tramite Depends (get\_dictionary\_service).
  \end{itemize}
  \item \textbf{Parametri}:
  \begin{itemize}
    \item \textbf{id (int)}: ID del dizionario da recuperare.
  \end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
  \item Effettua una chiamata al servizio di gestione dei dizionari per recuperare i dettagli del dizionario specificato;
  \item Restituisce un oggetto \texttt{DictionaryResponseDto} con lo stato della risposta e, in caso di successo, i dati richiesti.
\end{itemize}

\subsubsection{get\_dictionary\_file}

\subsubsubsection{Descrizione}
\par La funzione \texttt{get\_dictionary\_file} recupera il file associato a un dizionario specifico utilizzando l'ID fornito.

\subsubsubsection{Dettagli dell'endpoint}
\begin{itemize}
  \item \textbf{HTTP Method}: \texttt{GET};
  \item \textbf{Endpoint}: \texttt{/\{id\}/file};
  \item \textbf{Tags}: \texttt{[tag]};
  \item \textbf{Nome}: \texttt{getDictionaryFile};
  \item \textbf{Dependency Injection}:
  \begin{itemize}
    \item \textbf{dictionary\_service (DictionaryService)}: dipendenza risolta tramite Depends (get\_dictionary\_service).
  \end{itemize}
    \item \textbf{Parametri}:
  \begin{itemize}
    \item \textbf{id (int)}: ID del dizionario di cui recuperare il file.
  \end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
  \item Effettua una chiamata al servizio di gestione dei dizionari per recuperare il file associato al dizionario specificato;
  \item Se il dizionario viene trovato, restituisce il file come parte di una risposta HTTP (\texttt{FileResponse});
  \item Se il dizionario non viene trovato, restituisce un oggetto \texttt{ResponseDto} con lo stato della risposta.
\end{itemize}

\subsubsection{get\_dictionary\_preview}

\subsubsubsection{Descrizione}
\par La funzione \texttt{get\_dictionary\_preview} recupera l'anteprima di un dizionario utilizzando l'ID fornito e restituisce una risposta strutturata.

\subsubsubsection{Dettagli dell'endpoint}
\begin{itemize}
  \item \textbf{HTTP Method}: \texttt{GET};
  \item \textbf{Endpoint}: \texttt{/\{id\}/dictionary-preview};
  \item \textbf{Tags}: \texttt{[tag]};
  \item \textbf{Response Model}: \texttt{DictionaryResponseDto};
  \item \textbf{Nome}: \texttt{getDictionaryPreview};
  \item \textbf{Dependency Injection}:
  \begin{itemize}
    \item \textbf{dictionary\_service (DictionaryService)}: dipendenza risolta tramite Depends (get\_dictionary\_service).
  \end{itemize}
  \item \textbf{Parametri}:
  \begin{itemize}
    \item \textbf{id (int)}: ID del dizionario di cui recuperare l'anteprima.
  \end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
  \item Effettua una chiamata al servizio di gestione dei dizionari per recuperare l'anteprima del dizionario specificato;
  \item Restituisce un oggetto \texttt{DictionaryResponseDto} con lo stato della risposta e, in caso di successo, i dati richiesti.
\end{itemize}

\subsubsection{create\_dictionary}

\subsubsubsection{Descrizione}
\par La funzione \texttt{create\_dictionary} inserisce un nuovo dizionario nel sistema utilizzando i dati forniti e un file di configurazione.

\subsubsubsection{Dettagli dell'endpoint}
\begin{itemize}
  \item \textbf{HTTP Method}: \texttt{POST};
  \item \textbf{Endpoint}: \texttt{/};
  \item \textbf{Tags}: \texttt{[tag]};
  \item \textbf{Response Model}: \texttt{DictionaryResponseDto};
  \item \textbf{Dependencies}:
  \begin{itemize}
    \item \texttt{Depends(JwtBearer())}: autenticazione JWT necessaria per l'accesso all'endpoint.
  \end{itemize}
  \item \textbf{Nome}: \texttt{createDictionary};
  \item \textbf{Dependency Injection}:
  \begin{itemize}
    \item \textbf{dictionary\_service (DictionaryService)}: dipendenza risolta tramite Depends (get\_dictionary\_service).
  \end{itemize}
  \item \textbf{Parametri}:
  \begin{itemize}
    \item \textbf{file (Annotated[UploadFile, File()])}: il file associato al dizionario;
    \item \textbf{dictionary (DictionaryDto)}: i metadati del dizionario.
  \end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
  \item Verifica la presenza del file e legge il contenuto, se disponibile;
  \item Effettua una chiamata al servizio di gestione dei dizionari per salvare un nuovo izionario nel sistema;
  \item Restituisce un oggetto \texttt{DictionaryResponseDto} con lo stato della risposta e, in caso di successo, i dati del dizionario;
\end{itemize}

\subsubsection{update\_dictionary\_file}

\subsubsubsection{Descrizione}
\par La funzione \texttt{update\_dictionary\_file} aggiorna il file associato a un dizionario esistente utilizzando l'ID fornito e un nuovo file di configurazione.

\subsubsubsection{Dettagli dell'endpoint}
\begin{itemize}
  \item \textbf{HTTP Method}: \texttt{PUT};
  \item \textbf{Endpoint}: \texttt{/\{id\}/file};
  \item \textbf{Tags}: \texttt{[tag]};
  \item \textbf{Response Model}: \texttt{DictionaryResponseDto};
  \item \textbf{Dependencies}:
  \begin{itemize}
    \item \texttt{Depends(JwtBearer())}: autenticazione JWT necessaria per l'accesso all'endpoint.
  \end{itemize}
  \item \textbf{Nome}: \texttt{updateDictionaryFile};
  \item \textbf{Dependency Injection}:
  \begin{itemize}
    \item \textbf{dictionary\_service (DictionaryService)}: dipendenza risolta tramite Depends (get\_dictionary\_service).
  \end{itemize}
  \item \textbf{Parametri}:
  \begin{itemize}
    \item \textbf{id (int)}: ID del dizionario da aggiornare;
    \item \textbf{file (Annotated[UploadFile, File()])}: il file associato al dizionario.
  \end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
  \item Verifica la presenza del file e legge il contenuto, se disponibile;
  \item Effettua una chiamata al servizio di gestione dei dizionari per modificare il file associato al dizionario specificato;
  \item Restituisce un oggetto \texttt{DictionaryResponseDto} con lo stato della risposta e, in caso di successo, i dati del dizionario.
\end{itemize}

\subsubsection{update\_dictionary\_metadata}

\subsubsubsection{Descrizione}
\par La funzione \texttt{update\_dictionary\_metadata} aggiorna i metadati di un dizionario esistente utilizzando l'ID fornito e un oggetto \texttt{DictionaryDto}.

\subsubsubsection{Dettagli dell'endpoint}
\begin{itemize}
  \item \textbf{HTTP Method}: \texttt{PUT};
  \item \textbf{Endpoint}: \texttt{/\{id\}};
  \item \textbf{Tags}: \texttt{[tag]};
  \item \textbf{Response Model}: \texttt{DictionaryResponseDto};
  \item \textbf{Dependencies}:
  \begin{itemize}
    \item \texttt{Depends(JwtBearer())}: autenticazione JWT necessaria per l'accesso all'endpoint.
  \end{itemize}
  \item \textbf{Nome}: \texttt{updateDictionaryMetadata};
  \item \textbf{Dependency Injection}:
  \begin{itemize}
    \item \textbf{dictionary\_service (DictionaryService)}: dipendenza risolta tramite Depends (get\_dictionary\_service).
  \end{itemize}
  \item \textbf{Parametri}:
  \begin{itemize}
    \item \textbf{id (int)}: ID del dizionario da aggiornare;
    \item \textbf{dictionary (DictionaryDto)}: i nuovi metadati del dizionario.
  \end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
  \item Effettua una chiamata al servizio di gestione dei dizionari per modificare i metadati del dizionario specificato;
  \item Restituisce un oggetto \texttt{DictionaryResponseDto} con lo stato della risposta e, in caso di successo, i dati del dizionario.
\end{itemize}

\subsubsection{delete\_dictionary}

\subsubsubsection{Descrizione}
\par La funzione \texttt{delete\_dictionary} elimina un dizionario dal sistema utilizzando l'ID fornito.

\subsubsubsection{Dettagli dell'endpoint}
  \begin{itemize}
  \item \textbf{HTTP Method}: \texttt{DELETE};
  \item \textbf{Endpoint}: \texttt{/\{id\}};
  \item \textbf{Tags}: \texttt{[tag]};
  \item \textbf{Response Model}: \texttt{ResponseDto};
  \item \textbf{Nome}: \texttt{deleteDictionary};
  \item \textbf{Dependency Injection}:
  \begin{itemize}
    \item \textbf{dictionary\_service (DictionaryService)}: dipendenza risolta tramite Depends (get\_dictionary\_service).
  \end{itemize}
    \item \textbf{Parametri}:
  \begin{itemize}
    \item \textbf{id (int)}: ID del dizionario da eliminare.
  \end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
  \item Effettua una chiamata al servizio di gestione dei dizionari per eliminare il dizionario specificato;
  \item Restituisce un oggetto \texttt{ResponseDto} con lo stato della risposta.
\end{itemize}

%SEZIONE ROUTES DI login_api

\subsubsection{login}

\subsubsubsection{Descrizione}
\par La funzione \texttt{login} permette di autenticare un utente utilizzando le credenziali fornite. Se le credenziali sono corrette, viene restituito un token JWT.

\subsubsubsection{Dettagli dell'Endpoint}
\begin{itemize}
\item \textbf{HTTP Method}: \texttt{POST};
\item \textbf{Endpoint}: \texttt{/};
\item \textbf{Tags}: \texttt{[tag]};
\item \textbf{Response Model}: \texttt{AuthResponseDto};
\item \textbf{Nome}: \texttt{login};
\item \textbf{Dependency Injection}:
\begin{itemize}
\item \textbf{data (LoginDto)}: I dati di login dell'utente;
\item \textbf{db (Session)}: Dipendenza risolta tramite \texttt{Depends(get\_db)}.
\end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
\item Recupera l'utente dal database utilizzando \texttt{crud.get\_user\_by\_username(db,\- data\-.username)};
\item Se l'utente non viene trovato, restituisce un oggetto \texttt{AuthResponseDto} con \texttt{data\-=\-None} e lo stato \texttt{ResponseStatusEnum.NOT\_FOUND};
\item Se la password non è corretta, restituisce un oggetto \texttt{AuthResponseDto} con \texttt{data\-=\-None}, un messaggio di errore e lo stato \texttt{ResponseStatusEnum.BAD\_CREDENTIAL};
\item Genera un token JWT utilizzando \texttt{JwtHandler.sign(query.id)};
\item Restituisce un oggetto \texttt{AuthResponseDto} con il token generato e lo stato \texttt{Response\-Status\-Enum.OK}.
\end{itemize}

%SEZIONE ROUTES DI prompt_api

\subsubsection{generate\_prompt}

\subsubsubsection{Descrizione}
\par La funzione \texttt{generate\_prompt} genera un prompt utilizzando un dizionario specifico e una query forniti dall'utente. La funzione verifica la validità dei dati di input e restituisce il prompt generato.

\subsubsubsection{Dettagli dell'Endpoint}
\begin{itemize}
\item \textbf{HTTP Method}: \texttt{GET};
\item \textbf{Endpoint}: \texttt{/};
\item \textbf{Tags}: \texttt{[tag]};
\item \textbf{Response Model}: \texttt{StringDataResponseDto};
\item \textbf{Nome}: \texttt{generatePrompt};
\item \textbf{Dependency Injection}:
\begin{itemize}
\item \textbf{dictionary\_id (Annotated[int, Query(alias="dictionaryId")])}: L'ID del dizionario da utilizzare;
\item \textbf{query (str)}: La query fornita dall'utente;
\item \textbf{dbms (str)}: Il sistema di gestione del database (DBMS);
\item \textbf{lang (str)}: La lingua da utilizzare;
\item \textbf{db (Session)}: Dipendenza risolta tramite \texttt{Depends(get\_db)}.
\end{itemize}
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
\item Recupera il dizionario dal database utilizzando \texttt{crud.get\_dictionary\_by\_id(db, dictionary\_id)};
\item Se il dizionario non viene trovato, restituisce un oggetto \texttt{StringDataResponseDto} con un messaggio di errore e lo stato \texttt{ResponseStatusEnum.NOT\_FOUND};
\item Se la query è vuota o nulla, restituisce un oggetto \texttt{StringDataResponseDto} con un messaggio di errore e lo stato \texttt{ResponseStatusEnum.BAD\_REQUEST};
\item Carica l'indice del dizionario utilizzando \texttt{manager.load\_index(found\_dic.id)};
\item Genera il prompt utilizzando \texttt{manager.prompt\_generator(found\_dic.id, query, lang, dbms, activate\_log=True)};
\item Restituisce un oggetto \texttt{StringDataResponseDto} con il prompt generato e lo stato \texttt{ResponseStatusEnum.OK}.
\end{itemize}

\subsubsection{generate\_prompt\_debug}

\subsubsubsection{Descrizione}
\par La funzione \texttt{generate\_prompt\_debug} restituisce il contenuto del file di log per scopi di debug. Se il file di log non viene trovato, restituisce un messaggio di errore.

\subsubsubsection{Dettagli dell'Endpoint}
\begin{itemize}
\item \textbf{HTTP Method}: \texttt{GET};
\item \textbf{Endpoint}: \texttt{/debug};
\item \textbf{Tags}: \texttt{[tag]};
\item \textbf{Response Model}: \texttt{StringDataResponseDto};
\item \textbf{Nome}: \texttt{generatePromptDebug}.
\end{itemize}

\subsubsubsection{Implementazione}
\begin{itemize}
\item Tenta di aprire il file di log situato in \texttt{/opt/chatsql/logs/chatsql\_log.txt};
\item Se il file viene trovato, legge il contenuto e restituisce un oggetto \texttt{StringDataResponseDto} con i dati del file e lo stato \texttt{ResponseStatusEnum.OK};
\item Se il file non viene trovato, restituisce un oggetto \texttt{StringDataResponseDto} con un messaggio di errore e lo stato \texttt{ResponseStatusEnum.NOT\_FOUND}.
\end{itemize}

% TABELLA TRACCIAMENTO REQUISITI

\subsubsection{Tracciamento dei requisiti}
\bgroup
\begin{adjustwidth}{-0.5cm}{-0.5cm}
	\centering
	% MAX 12.5cm
  \begin{longtable}{|c|c|}
		\caption{Tracciamento dei requisiti back-end}
  	\label{tab:tracciamento-requisiti-back-end} \\
    \hline
		\textbf{ID} & \textbf{Route} \\
		\hline
		\endfirsthead

		\caption[]{Tracciamento dei requisiti back-end (continua)} \\
		\hline
		\textbf{ID} & \textbf{Route} \\
		\hline
		\endhead

		\hline
		\multicolumn{2}{|r|}{{Continua nella prossima pagina}} \\
		\hline
		\endfoot

		\hline
		\endlastfoot

    RF.O.1 & \texttt{login} \\
	  \hline RF.O.2 & \texttt{login} \\
    \hline RF.O.3 & \texttt{generate\_prompt}\\
    \hline RF.O.6 & \texttt{generate\_prompt}, \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.O.9 & \texttt{get\_all\_dictionaries} \\
    \hline RF.O.9.1 & \texttt{get\_all\_dictionaries} \\
    \hline RF.O.10 & \texttt{get\_all\_dictionaries}, \texttt{get\_dictionary} \\
    \hline RF.O.10.1 & \texttt{get\_all\_dictionaries}, \texttt{get\_dictionary} \\
    \hline RF.O.10.2 & \texttt{get\_all\_dictionaries}, \texttt{get\_dictionary} \\
    \hline RF.O.10.3 & \texttt{get\_all\_dictionaries}, \texttt{get\_dictionary} \\
    \hline RF.O.11 & \texttt{generate\_prompt}, \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.O.13 & \texttt{create\_dictionary} \\
    \hline RF.O.14 & \texttt{get\_dictionary\_preview} \\
    \hline RF.O.14.1 & \texttt{get\_dictionary\_preview} \\
    \hline RF.O.14.2 & \texttt{get\_dictionary\_preview} \\
    \hline RF.O.14.3 & \texttt{get\_dictionary\_preview} \\
    \hline RF.O.14.3.1 & \texttt{get\_dictionary\_preview} \\
    \hline RF.O.14.3.1.1 & \texttt{get\_dictionary\_preview} \\
    \hline RF.O.14.3.1.2 & \texttt{get\_dictionary\_preview} \\
    \hline RF.O.15 & \texttt{create\_dictionary} \\
    \hline RF.O.16 & \texttt{create\_dictionary} \\
    \hline RF.O.17 & \texttt{create\_dictionary} \\
    \hline RF.O.18 & \texttt{delete\_dictionary} \\
    \hline RF.O.19 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
    \hline RF.O.20 & \texttt{update\_dictionary\_file} \\
    \hline RF.O.21 & \texttt{delete\_dictionary} \\
    \hline RF.O.22 & \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.O.28 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
    \hline RF.O.29 & \texttt{update\_dictionary\_metadata} \\
    \hline RF.O.30 & \texttt{update\_dictionary\_metadata} \\
    \hline RF.O.31 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_metadata} \\
    \hline RF.O.31.1 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_metadata} \\
    \hline RF.O.31.2 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_metadata} \\
    \hline RF.O.32 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_metadata} \\
    \hline RF.O.33 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
    \hline RF.O.34 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
    \hline RF.O.35 & \texttt{generate\_prompt}, \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.O.37 & \texttt{get\_dictionary\_file} \\
    \hline RF.O.39 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
    \hline RF.D.40 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
    \hline RF.O.41 & \texttt{generate\_prompt}, \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.OP.42 & \texttt{generate\_prompt}, \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.O.45 & \texttt{generate\_prompt}, \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.O.46 & \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.O.47 & \texttt{generate\_prompt}, \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.D.52 & \texttt{generate\_prompt}, \texttt{generate\_prompt\_with\_debug} \\
    \hline RF.O.55 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
    \hline RF.O.56 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
    \hline RF.O.57 & \texttt{create\_dictionary}, \texttt{update\_dictionary\_file} \\
  \end{longtable}
\end{adjustwidth}
\egroup